schemaVersion: 2.2.2                               # This is the schema version for the devfile
metadata:                                          # Metadata about the project
  name: python-demo-app                            # The name of the project
  attributes:
    alpha.dockerimage-port: 8080                   # The port that the application is running on


### List of avaliable components/tasks that can be done ###
components:
  - name: image-build                              # This component builds the container image
    image:
      imageName: python-image:latest               # The name of the image to build
      dockerfile:
        uri: docker/Dockerfile                     # The path to the Dockerfile
        buildContext: .                            # The build context for the Dockerfile
        rootRequired: false                        # Whether root privileges are required to build the image

  - name: kubernetes-deploy                        # This component deploys the application to Kubernetes
    attributes:
      deployment/container-port: 8080              # The port that the container is listening on
    kubernetes:
      uri: deploy.yml                              # The path to the Kubernetes manifest
      endpoints:                                   # Used during development - tells your IDE/developer tools how to connect to and interact with the running app
        - name: http-8080
          targetPort: 8080
          path: /


### Commands that run a component or multiple other commands ###
commands:
  - id: build-image                                # This command builds the container image
    apply:
      component: image-build
      
  - id: deployk8s                                  # This command deploys the application to Kubernetes
    apply:
      component: kubernetes-deploy

  - id: deploy                                     # This is a composite command that builds and deploys the application
    composite:
      commands:
        - build-image
        - deployk8s
      group:
        kind: deploy                               # This command is a deploy command
        isDefault: true                            # This is the default deploy command